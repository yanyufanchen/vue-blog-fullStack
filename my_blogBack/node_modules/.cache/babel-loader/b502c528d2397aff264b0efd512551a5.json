{"remainingRequest":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\src\\components\\Book\\OverdueInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\src\\components\\Book\\OverdueInfo.vue","mtime":1578115298646},{"path":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\wangpeng\\\\Desktop\\\\mt\\\\vue-ht\\\\library\\\\my_library\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getAuthorAll, getAllBook, loanBook_api, getLoan_api, addLoan_api, updataLoan_api, deleteLoan_api, getPenalty_api } from '@/api';\nimport moment from 'moment'; // 时间过滤插件\n\nexport default {\n  data: function data() {\n    return {\n      pickerOptions0: {\n        disabledDate: function disabledDate(time) {\n          return time.getTime() < Date.now(); //如果没有后面的-8.64e7就是不可以选择今天的\n        }\n      },\n      common: ['overdueInfo'],\n      // 公共组件传值\n      input1: '',\n      value1: '',\n      allCount: null,\n      currentPage: 1,\n      pageSize: 10,\n      tableData: [],\n      comName: [],\n      comTitle: [],\n      dialogFormVisible: false,\n      editFormVisible: false,\n      show: true,\n      addForm: {\n        name: '',\n        title: '',\n        dueDate: '',\n        BookId: '',\n        UserId: '',\n        id: ''\n      },\n      editRegion: {\n        name: '',\n        title: '',\n        dueDate: '',\n        BookId: '',\n        UserId: '',\n        id: ''\n      },\n      formLabelWidth: '140px',\n      rules: {\n        name: [{\n          required: true,\n          message: 'Please input name',\n          trigger: 'blur'\n        }],\n        title: [{\n          required: true,\n          message: 'Please input title',\n          trigger: 'blur'\n        }],\n        dueDate: [{\n          required: true,\n          message: 'Please input date',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created: function created() {\n    this.getLoanBookAll(); // this.getAuthorAll()\n    // this.getAllBook()\n  },\n  methods: {\n    // 清除clearInput\n    clear: function clear() {\n      this.show = true;\n      this.getLoanBookAll();\n    },\n    //获取借阅及逾期信息\n    getLoanBookAll: function () {\n      var _getLoanBookAll = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var _ref, penalty_res, penaltyNum, params, _ref2, res, i;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return getPenalty_api({\n                  PenaltyId: 1\n                });\n\n              case 2:\n                _ref = _context.sent;\n                penalty_res = _ref.data;\n                penaltyNum = penalty_res.data.delay_penalty;\n\n                if (penalty_res.status !== 200) {\n                  penaltyNum = 0;\n                }\n\n                params = {\n                  \"pagesize\": this.pageSize,\n                  \"pageNO\": this.currentPage\n                };\n                _context.next = 9;\n                return loanBook_api(params);\n\n              case 9:\n                _ref2 = _context.sent;\n                res = _ref2.data;\n\n                if (!(res.status !== 200)) {\n                  _context.next = 13;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", this.$message.error(res.msg));\n\n              case 13:\n                for (i in res.data) {\n                  res.data[i].overdueTime = Math.ceil((res.data[i].dueDate - +new Date()) / 1000 / 60 / 60 / 24);\n\n                  if (res.data[i].overdueTime <= 0) {\n                    res.data[i].delay_penalty = '￥ ' + res.data[i].overdueTime * penaltyNum;\n                    res.data[i].overdueTime = 'overdue ' + Math.abs(res.data[i].overdueTime) + ' day';\n                  } else {\n                    res.data[i].delay_penalty = '￥ ' + 0;\n                    res.data[i].overdueTime = 'only ' + res.data[i].overdueTime + ' day';\n                  }\n\n                  res.data[i].dueDate = moment(res.data[i].dueDate).format('YYYY-MM-DD');\n                }\n\n                this.tableData = res.data;\n                this.allCount = res.total;\n\n              case 16:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getLoanBookAll() {\n        return _getLoanBookAll.apply(this, arguments);\n      }\n\n      return getLoanBookAll;\n    }(),\n    //分页\n    handleCurrentChange: function () {\n      var _handleCurrentChange = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2(currentPage) {\n        var params, _ref3, res, i;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.currentPage = currentPage;\n                params = {\n                  \"pagesize\": this.pageSize,\n                  \"pageNO\": this.currentPage\n                };\n                _context2.next = 4;\n                return loanBook_api(params);\n\n              case 4:\n                _ref3 = _context2.sent;\n                res = _ref3.data;\n\n                if (!(res.status !== 200)) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", this.$message.error(res.msg));\n\n              case 8:\n                for (i in res.data) {\n                  res.data[i].dueDate = moment(res.data[i].dueDate).format('YYYY-MM-DD');\n                }\n\n                this.tableData = res.data;\n                this.allCount = res.total;\n\n              case 11:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function handleCurrentChange(_x) {\n        return _handleCurrentChange.apply(this, arguments);\n      }\n\n      return handleCurrentChange;\n    }(),\n    //query\n    searchClick: function searchClick() {\n      var _this = this;\n\n      // 查询功能\n      var nameCom = this.input1; //读者名\n\n      var bookCom = this.value1; // 书名\n\n      if (nameCom == '' && bookCom == '') {\n        this.show = true;\n        this.getLoanBookAll();\n      } else {\n        var params = {\n          \"bookTitle\": bookCom,\n          \"userName\": nameCom\n        };\n        getLoan_api(params).then(function (res) {\n          if (res.data.status !== 200) {\n            return _this.$message.error(res.data.data.msg);\n          } else {\n            for (var i in res.data.data) {\n              res.data.data[i].dueDate = moment(res.data.data[i].dueDate).format('YYYY-MM-DD');\n            }\n\n            _this.tableData = res.data.data;\n            _this.allCount = res.data.data.length;\n          }\n        });\n      }\n    },\n    //add\n    submitForm: function submitForm(formName) {\n      var _this2 = this;\n\n      var that = this;\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          var timestamp2 = Date.parse(new Date(that.addForm.dueDate));\n          var params = {\n            \"bookTitle\": that.addForm.title,\n            \"userName\": that.addForm.name,\n            \"dueDate\": timestamp2\n          };\n\n          _this2.$confirm('Whether to commit', {\n            confirmButtonText: 'confirm',\n            cancelButtonText: 'cancel',\n            type: 'warning',\n            center: true\n          }).then(function () {\n            //ajax\n            addLoan_api(params).then(function (res) {\n              if (res.status == 200) {\n                //此处的表单验证\n                that.dialogFormVisible = false;\n                that.getLoanBookAll(); //重新渲染数据\n              } else {\n                that.$confirm(res.result.msg, 'hint', {\n                  type: 'warning'\n                });\n              }\n            }).catch(function (err) {\n              console.log(err);\n            });\n          }).catch(function (err) {\n            console.log('Cancel');\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    handleEdit: function handleEdit(index, row) {\n      this.editFormVisible = true;\n      this.editRegion = Object.assign({\n        dueDate: row.dueDate,\n        LoanId: row.id\n      }); //这句是关键！！！\n    },\n    editSubmitRegion: function editSubmitRegion(formName) {\n      var _this3 = this;\n\n      var that = this;\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          var timestamp2 = Date.parse(new Date(that.editRegion.dueDate));\n          var params = {\n            duetime: timestamp2,\n            LoanId: that.editRegion.LoanId\n          };\n\n          _this3.$confirm('Whether to commit', {\n            confirmButtonText: 'confirm',\n            cancelButtonText: 'cancel',\n            type: 'warning',\n            center: true\n          }).then(function () {\n            //ajax\n            updataLoan_api(params).then(function (res) {\n              if (res.data.status == 200) {\n                that.editFormVisible = false;\n                that.getLoanBookAll(); //重新渲染数据\n              } else {\n                that.$confirm(res.data.msg, 'hint', {\n                  type: 'warning'\n                });\n              }\n            }).catch(function (err) {\n              console.log(err);\n            });\n          }).catch(function (err) {\n            console.log('Cancel');\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    //delete\n    handleDelete: function handleDelete(index, row) {\n      var _self = this;\n\n      this.$confirm('Are you sure to delete?', 'hint', {\n        confirmButtonText: 'delete',\n        cancelButtonText: 'waiting',\n        type: 'warning',\n        center: true\n      }).then(function () {\n        var params = {\n          loanId: row.id\n        };\n        deleteLoan_api({\n          data: params\n        }).then(function (res) {\n          if (res.status == 200) {\n            _self.$message({\n              message: 'successfully delete',\n              type: 'success'\n            });\n\n            _self.getLoanBookAll(); //重新渲染数据\n\n          }\n        }).catch(function (err) {\n          console.log(err);\n        });\n      }).catch(function (e) {\n        if (e != \"cancel\") console.log(\"error：\" + e);\n      });\n    }\n  },\n  mounted: function mounted() {}\n};",{"version":3,"sources":["OverdueInfo.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div>\r\n    <!-- 导航 -->\r\n    <Breadcrumb :value=\"common\"></Breadcrumb>\r\n    <el-card class=\"box-card\">\r\n      <!-- 借阅逾期管理 -->\r\n      <el-row class=\"checking\">\r\n        <el-col :span=\"18\">\r\n          <div class=\"grid-content bg-purple\">\r\n            <span class=\"com_title\">Borrower：</span>\r\n            <el-input\r\n              class=\"codeName\"\r\n              ref=\"com_name\"\r\n              size=\"small\"\r\n              placeholder=\"Please enter the borrower's name\"\r\n              v-model=\"input1\"\r\n              clearable\r\n              @clear=\"clear\"\r\n            ></el-input>\r\n            <span class=\"com_title\">Titles of books：</span>\r\n            <el-input\r\n              class=\"codeName\"\r\n              size=\"small\"\r\n              ref=\"com_name\"\r\n              placeholder=\"Please enter title\"\r\n              v-model=\"value1\"\r\n              clearable\r\n              @clear=\"clear\"\r\n            ></el-input>\r\n            <el-button type=\"info\" size=\"small\" @click=\"searchClick\">Query</el-button>\r\n          </div>\r\n        </el-col>\r\n      </el-row>\r\n      <el-table :data=\"tableData\" style=\"width: 100%\">\r\n        <el-table-column prop=\"name\" label=\"Borrower\"></el-table-column>\r\n        <el-table-column prop=\"title\" label=\"Title\"></el-table-column>\r\n        <el-table-column prop=\"dueDate\" label=\"Return date\"></el-table-column>\r\n        <el-table-column prop=\"overdueTime\" label=\"overdue time\"></el-table-column>\r\n        <el-table-column prop=\"delay_penalty\" label=\"delay penalty\"></el-table-column>\r\n      </el-table>\r\n      <el-pagination\r\n        v-if=\"show\"\r\n        class=\"page_size\"\r\n        background=\"\"\r\n        layout=\"prev, pager, next\"\r\n        :page-size=\"pageSize\"\r\n        :current-page=\"currentPage\"\r\n        @current-change=\"handleCurrentChange\"\r\n        :total=\"allCount\"\r\n      ></el-pagination>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n<script>\r\n  import {getAuthorAll, getAllBook,loanBook_api,getLoan_api,addLoan_api,updataLoan_api,deleteLoan_api,getPenalty_api} from '@/api'\r\n  import moment from 'moment' // 时间过滤插件\r\nexport default {\r\n  data() {\r\n    return {\r\n      pickerOptions0: {\r\n        disabledDate(time) {\r\n          return time.getTime() < Date.now()//如果没有后面的-8.64e7就是不可以选择今天的\r\n       }\r\n      },\r\n      common: ['overdueInfo'], // 公共组件传值\r\n      input1: '',\r\n      value1: '',\r\n      allCount:null,\r\n      currentPage:1,\r\n      pageSize:10,\r\n      tableData: [],\r\n      comName:[],\r\n      comTitle:[],\r\n      dialogFormVisible: false,\r\n      editFormVisible: false,\r\n      show:true,\r\n      addForm: {\r\n        name: '',\r\n        title: '',\r\n        dueDate: '',\r\n        BookId:'',\r\n        UserId:'',\r\n        id:'',\r\n      },\r\n      editRegion: {\r\n        name: '',\r\n        title: '',\r\n        dueDate: '',\r\n        BookId:'',\r\n        UserId:'',\r\n        id:'',\r\n      },\r\n      formLabelWidth: '140px',\r\n      rules: {\r\n        name: [{ required: true, message: 'Please input name', trigger: 'blur' }],\r\n        title: [{ required: true, message: 'Please input title', trigger: 'blur' }],\r\n        dueDate: [{ required: true, message: 'Please input date', trigger: 'blur' }]\r\n\t\t  }\r\n    }\r\n  },\r\n  created() {\r\n    this.getLoanBookAll()\r\n    // this.getAuthorAll()\r\n    // this.getAllBook()\r\n  },\r\n  methods: {\r\n    // 清除clearInput\r\n    clear(){\r\n      this.show = true;\r\n        this.getLoanBookAll()\r\n    },\r\n    //获取借阅及逾期信息\r\n    async getLoanBookAll() {\r\n      const { data: penalty_res } = await getPenalty_api({PenaltyId: 1})\r\n      let penaltyNum=penalty_res.data.delay_penalty\r\n      if (penalty_res.status!== 200){\r\n        penaltyNum=0\r\n      }\r\n      let params = {\r\n        \"pagesize\":this.pageSize,\r\n        \"pageNO\":this.currentPage\r\n      }\r\n      const { data: res } = await loanBook_api(params)\r\n      if (res.status !== 200) return this.$message.error(res.msg)\r\n      for (var i in res.data) {\r\n        res.data[i].overdueTime=Math.ceil((res.data[i].dueDate-(+new Date()))/1000/60/60/24)\r\n        \r\n        if(res.data[i].overdueTime<=0){\r\n          res.data[i].delay_penalty='￥ '+res.data[i].overdueTime*penaltyNum\r\n          res.data[i].overdueTime='overdue '+Math.abs(res.data[i].overdueTime)+' day'\r\n        }else {\r\n          res.data[i].delay_penalty='￥ '+0\r\n          res.data[i].overdueTime='only '+res.data[i].overdueTime+' day'\r\n        }\r\n        res.data[i].dueDate = moment(res.data[i].dueDate).format('YYYY-MM-DD')\r\n      }\r\n      this.tableData = res.data\r\n      this.allCount = res.total\r\n    },\r\n    //分页\r\n    async handleCurrentChange(currentPage){\r\n      this.currentPage = currentPage;\r\n      let params = {\r\n        \"pagesize\":this.pageSize,\r\n        \"pageNO\":this.currentPage\r\n      }\r\n      const { data: res } = await loanBook_api(params)\r\n      if (res.status !== 200) return this.$message.error(res.msg)\r\n      for (var i in res.data) {\r\n        res.data[i].dueDate = moment(res.data[i].dueDate).format('YYYY-MM-DD')\r\n      }\r\n      this.tableData = res.data\r\n      this.allCount = res.total\r\n    },\r\n\t  //query\r\n\t  searchClick(){ // 查询功能\r\n\t  \tconst nameCom = this.input1; //读者名\r\n\t  \tconst bookCom = this.value1; // 书名\r\n      if(nameCom == '' && bookCom == ''){\r\n        this.show = true;\r\n        this.getLoanBookAll()\r\n      }else{\r\n\r\n        var params = {\r\n          \"bookTitle\": bookCom,\r\n          \"userName\": nameCom\r\n        }\r\n        getLoan_api(params).then(res => {\r\n          if (res.data.status !== 200) {\r\n            return this.$message.error(res.data.data.msg)\r\n          } else {\r\n            for (var i in res.data.data) {\r\n              res.data.data[i].dueDate = moment(res.data.data[i].dueDate).format('YYYY-MM-DD')\r\n            }\r\n            this.tableData = res.data.data\r\n            this.allCount = res.data.data.length\r\n          }\r\n        })\r\n      }\r\n\t  },\r\n\t  //add\r\n\t  submitForm(formName){\r\n\t      var that = this\r\n\t  \tthis.$refs[formName].validate((valid) =>{\r\n\t  \t\tif(valid){\r\n          var timestamp2 = Date.parse(new Date(that.addForm.dueDate))\r\n\t  \t\t\tvar params ={\r\n            \"bookTitle\":that.addForm.title,\r\n            \"userName\":that.addForm.name,\r\n            \"dueDate\":timestamp2\r\n          }\r\n\t  \t\t\tthis.$confirm('Whether to commit',{\r\n\t  \t\t\t\tconfirmButtonText:'confirm',\r\n\t  \t\t\t\tcancelButtonText:'cancel',\r\n\t  \t\t\t\ttype:'warning',\r\n\t  \t\t\t\tcenter:true\r\n\t  \t\t\t})\r\n\t  \t\t\t.then(function(){\r\n\t  \t\t\t\t//ajax\r\n\t  \t\t\t\taddLoan_api(params).then(res =>{\r\n\t  \t\t\t\t\tif(res.status == 200){ //此处的表单验证\r\n\t  \t\t\t\t\t\tthat.dialogFormVisible = false\r\n\t  \t\t\t\t\t\tthat.getLoanBookAll() //重新渲染数据\r\n\t  \t\t\t\t\t}else{\r\n\t  \t\t\t\t\tthat.$confirm(res.result.msg, 'hint', {\r\n\t                    type: 'warning'\r\n\t               \t})\r\n              }\r\n\t  \t\t\t\t}).catch(err =>{console.log(err)})\r\n\t  \t\t\t})\r\n\t  \t\t\t.catch(function(err){\r\n\t  \t\t\t\tconsole.log('Cancel')\r\n\t  \t\t\t})\r\n\t  \t\t} else {\r\n\t  \t\t\treturn false\r\n\t  \t\t}\r\n\t  \t})\r\n\t  },\r\n\t  handleEdit(index, row) {\r\n\t      this.editFormVisible = true;\r\n\t      this.editRegion = Object.assign({\r\n          dueDate: row.dueDate,\r\n          LoanId:row.id\r\n          }); //这句是关键！！！\r\n\t  },\r\n\t  editSubmitRegion (formName) {\r\n\t  \tvar that = this\r\n\t  \tthis.$refs[formName].validate((valid) =>{\r\n\t  \t\tif(valid){\r\n          var timestamp2 = Date.parse(new Date(that.editRegion.dueDate))\r\n          var params = {\r\n            duetime: timestamp2,\r\n            LoanId:that.editRegion.LoanId\r\n          }\r\n\t  \t\t\tthis.$confirm('Whether to commit',{\r\n\t  \t\t\t\tconfirmButtonText:'confirm',\r\n\t  \t\t\t\tcancelButtonText:'cancel',\r\n\t  \t\t\t\ttype:'warning',\r\n\t  \t\t\t\tcenter:true\r\n\t  \t\t\t})\r\n\t  \t\t\t.then(function(){\r\n\t  \t\t\t\t//ajax\r\n\t  \t\t\t\tupdataLoan_api(params).then(res =>{\r\n\t  \t\t\t\t\tif(res.data.status == 200){\r\n\t  \t\t\t\t\t\tthat.editFormVisible = false\r\n\t  \t\t\t\t\t\tthat.getLoanBookAll() //重新渲染数据\r\n\t  \t\t\t\t\t}else{\r\n\t  \t\t\t\t\t\tthat.$confirm(res.data.msg, 'hint', {\r\n\t                    type: 'warning'\r\n\t               \t})\r\n\t  \t\t\t\t\t}\r\n\t  \t\t\t\t}).catch(err =>{console.log(err)})\r\n\t  \t\t\t})\r\n\t  \t\t\t.catch(function(err){\r\n\t  \t\t\t\tconsole.log('Cancel')\r\n\t  \t\t\t})\r\n\t  \t\t} else {\r\n\t  \t\t\treturn false\r\n\t  \t\t}\r\n\t  \t})\r\n\t  },\r\n\t  //delete\r\n\t  handleDelete (index,row) {\r\n\t      var _self = this;\r\n\t      this.$confirm('Are you sure to delete?', 'hint', {\r\n        confirmButtonText:'delete',\r\n        cancelButtonText:'waiting',\r\n        type:'warning',\r\n        center:true\r\n          }).then(function(){\r\n          let params = {\r\n            loanId:row.id\r\n          }\r\n          deleteLoan_api({data:params}).then(res => {\r\n            if(res.status == 200){\r\n              _self.$message({\r\n                message: 'successfully delete',\r\n                type: 'success'\r\n              });\r\n          _self.getLoanBookAll() //重新渲染数据\r\n            }\r\n          }).catch(err =>{console.log(err)})\r\n          }).catch(function(e){\r\n            if(e != \"cancel\")\r\n              console.log(\"error：\" + e);\r\n          });\r\n      },\r\n  },\r\n  mounted() {}\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.checking{\r\n  margin: 20px 0;\r\n  .codeName{\r\n    width: 12.5rem;margin-right: 10px;\r\n  }\r\n  .add{float: right;}\r\n}\r\n.page_size{display: inline-block;float: right;}\r\n</style>\r\n"],"sourceRoot":"src/components/Book"}]}